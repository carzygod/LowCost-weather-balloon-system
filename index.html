<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test</title>
</head>
<body onload="init()">
    <video id="video" width="300" height="300" poster="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic.51yuansu.com%2Fpic3%2Fcover%2F01%2F14%2F62%2F59043cebb703f_610.jpg&refer=http%3A%2F%2Fpic.51yuansu.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1637115934&t=cd4ebc01b4b11fb45ce65a3b2dc7e933"></video>
	<canvas id="canvas" width="300" height="300"></canvas><br>
    <button id="camera">ÊëÑÂÉèÂ§¥</button><button id="snap">ÊãçÁÖß</button>
    <div id="gps"></div>
    <div id="img"></div>

    alpha:<span id="alpha"></span><br/>
    beta:<span id="beta"></span><br/>
    gamma:<span id="gamma"></span><br/>

    <div id="test"></div>
</body>
<script>
    	//Áî®Êù•ÂåπÈÖç‰∏çÂêåÁöÑÊµèËßàÂô®
		function getUserMedia(constraints,success,error){
			if(navigator.mediaDevices.getUserMedia){
				navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);
			}else if (navigator.webkitGetUserMedia) {
				navigator.webkitGetUserMedia(constraints,success,error);
			}else if (navigator.mozGetUserMedia) {
				navigator.mozGetUserMedia(constraints,success,error);
			}else if (navigator.getUserMedia) {
				navigator.getUserMedia(constraints,success,error)
			}
		}

		//ÊàêÂäüÂõûË∞É
		function success(stream){
			video.srcObject = stream;
			video.play();
		}
		//Â§±Ë¥•ÂõûË∞É
		function error(error) {
			console.log("ËÆøÈóÆÁî®Êà∑Â™í‰ΩìÂ§±Ë¥•");
		}

        document.getElementById('camera').addEventListener('click',function(){
		});


        function sleep (ms) {
            return new Promise((resolve) => {
            setTimeout(resolve, ms);
            });
        }


        async function cameraInit()
        {
            console.log("üî• Camera init")
            //ËßÜÈ¢ëÁ™óÂè£Â∞∫ÂØ∏
            let size = 300;
            let video = document.getElementById('video');
            let canvas = document.getElementById('canvas');
            let context = canvas.getContext('2d');

            //ÂºÄÂêØÊëÑÂÉèÂ§¥
            if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
                getUserMedia({video:{width:size,height:size}},success,error)
            }else {
                alert("‰∏çÊîØÊåÅ");
            }
            //ÂÆûÁé∞ÊãçÁÖßÁöÑÂäüËÉΩ
            document.getElementById('snap').addEventListener('click',function(){
                context.drawImage(video,0,0,size,size);
                const data = canvas.toDataURL("image/png");
                console.log(" üç∫ Photo",data)
                document.getElementById("img").innerHTML = " üç∫ Photo"+data
            });

            console.log("üî• Camera Loop init")
            while(true)
            {
                await sleep(1000)
                context.drawImage(video,0,0,size,size);
                const data = canvas.toDataURL("image/png");
                console.log(" üç∫ Photo",data)
                document.getElementById("img").innerHTML = " üç∫ Photo"+data
                
            }

        }

        async function gpsLoop()
        {
            console.log("üî• GPS loop init")
            while(true)
            {
                await sleep(1000)
                navigator.geolocation.getCurrentPosition((loc) => {
                    console.log('The location in lat lon format is: [', loc.coords.latitude, ',', loc.coords.longitude, ']');

                    document.getElementById("gps").innerHTML = `üìå latitude :${loc.coords.latitude} :: longitude:${loc.coords.longitude} :: altitude ${loc.coords.altitude}:: speed ${loc.coords.speed}:: heading ${loc.coords.heading}`
                })
               
            }
        }

        function orientationLoop()
        {
            console.log("üî• GPS loop init")
            if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', function (event) {
                var a = document.getElementById('alpha'),
                    b = document.getElementById('beta'),
                    g = document.getElementById('gamma'),
                    alpha = event.alpha,
                    beta = event.beta,
                    gamma = event.gamma;
    
                a.innerHTML = Math.round(alpha);
                b.innerHTML = Math.round(beta);
                g.innerHTML = Math.round(gamma);
    
                }, false);
            } else {
                document.querySelector('body').innerHTML = 'Browser not support ';
            }
        }

        function MagnetometerLoop()
        {
            document.getElementById("magnetometer").innerHTML = `MagnetometerLoop Init`
            let magSensor = new Magnetometer({ frequency: 60 });
            document.getElementById("magnetometer").innerHTML = `MagnetometerLoop Init success`
            magSensor.addEventListener("reading", (e) => {
            console.log(`Magnetic field along the X-axis ${magSensor.x}`);
            console.log(`Magnetic field along the Y-axis ${magSensor.y}`);
            console.log(`Magnetic field along the Z-axis ${magSensor.z}`);

            document.getElementById("magnetometer").innerHTML = ` X-axis ${magSensor.x} | Y-axis ${magSensor.y} | Z-axis ${magSensor.z}`
            });
            magSensor.start();
        }


        function init()
        {
            console.log("üî• Init")
            cameraInit()
            gpsLoop()
            orientationLoop()
            // MagnetometerLoop()
        }

        
</script>
</html>
